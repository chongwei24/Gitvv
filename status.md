---
theme: fancy
highlight:  vs
---
在进行`Git`命令操作时，了解仓库的当前状态是至关重要的。这不仅是因为`Git`仓库可能包含大量文件，而且随着项目的进展，文件的状态也会频繁发生变化。为了有效地管理这些变更，我们需要清晰地知道哪些文件已被修改、哪些文件已添加到暂存区、哪些文件是新增的以及哪些文件被`.gitignore`文件忽略等。

`git status`命令在这里扮演了至关重要的角色。它为我们提供了一个快速查看仓库当前状态的窗口，让我们能够一目了然地看到哪些文件需要关注，哪些文件已经准备好提交，以及哪些文件我们可能不需要关注。通过`git status`，我们可以避免不必要的混淆和错误，确保我们的提交只包含我们想要更改的内容。

本小节我们将深入学习`git status`命令的核心功能，并实现我们自己的`gitv status`命令，以便更好地理解其工作原理和重要性。

##  `git status`基本使用

 - 基本语法

    ```sh
    git status
    ```

    只需在 `Git` 仓库的根目录（或任何子目录）中运行上述命令，即可查看当前的状态。

- 输出内容

    `git status` 命令的输出通常包括以下几个部分：

    *   **未跟踪的文件**：这些文件是新添加到工作目录中的，但尚未被 Git 跟踪。它们会出现在输出的最上方，并标记为 "Untracked files"。
    *   **已修改的文件**：这些文件已经存在于 Git 仓库中，但已被修改且尚未提交。它们会列出每个文件的名称，并标记为 "modified"。
    *   **已添加到暂存区的文件**：这些文件已经被修改，并且已经被添加到暂存区（通过 `git add` 命令），但尚未提交。它们也会列出每个文件的名称，但通常不会有额外的标记，因为它们是“干净”的（即与暂存区中的版本一致）。

-  示例输出

以下是一个示例的 `git status` 输出：

```sh
	On branch master  
	Your branch is up to date with 'origin/master'.    

	Changes not staged for commit:  
	  (use "git add <file>..." to update what will be committed)  
	  (use "git checkout -- <file>..." to discard changes in working directory)  

	    modified:   README.md  

	Untracked files:  

	  (use "git add <file>..." to include in what will be committed)  

	    new_file.txt

	no changes added to commit (use "git add" and/or "git commit -a")
```

在这个示例中：

    *   我们当前在 `master` 分支上。
    *   有一个已修改但尚未添加到暂存区的文件 `README.md`。
    *   有一个未跟踪的文件 `new_file.txt`。

- 常用选项

    *   `--short` 或 `-s`：以简短的形式显示状态。这通常只显示已修改和未跟踪的文件列表，而不包括其他详细信息。
    *   `--porcelain`：以机器可读的格式输出状态。这通常用于脚本和自动化工具。
    *   `--ignored`：显示被 `.gitignore` 文件忽略的文件。

- 使用建议

    *   在开始新的工作之前，使用 `git status` 检查当前的工作目录和暂存区状态。
    *   在提交更改之前，使用 `git status` 确认你要提交的文件和更改。
    *   如果你只想查看已修改的文件，可以使用 `git status --short` 或 `git status -s`。

## **需求分析**

### 概述实现目标

当使用 `git status` 命令时，`Git` 会利用其内部的索引（`index` 或 `staging area`）来跟踪文件的状态，并通过对比工作目录、暂存区和最近一次提交的内容来区分不同状态的文件。

### 命令实现详细剖析

1. 未跟踪的文件
未跟踪的文件是指那些尚未被 Git 纳入版本控制的文件。这些文件可能是新添加到工作目录中的，但还没有通过 git add 命令添加到暂存区。

实现思路：

遍历工作目录中的所有文件和目录。
对于每个文件，检查它是否存在于 Git 仓库的索引（即暂存区）中。这可以通过查询 Git 索引来完成。
如果文件不存在于索引中，则将其标记为未跟踪的文件。

2. 已修改的文件
已修改的文件是指那些已经被 Git 纳入版本控制，但已经被修改并且尚未提交到仓库中的文件。这些文件可能已经被添加到暂存区，也可能没有，但无论如何，它们在工作目录中的内容与最后一次提交到仓库的内容不同。

实现思路：

遍历 Git 索引中的所有文件。
对于每个文件，比较它在工作目录中的内容与 Git 仓库中最后一次提交的内容。这可以通过比较文件的哈希值（如 SHA-1）来实现。
如果文件的内容不同，则将其标记为已修改的文件。
3. 已添加到暂存区的文件
已添加到暂存区的文件是指那些已经被 git add 命令添加到暂存区中的文件。这些文件可能已经被修改，但由于它们已经被添加到暂存区，因此它们的状态在提交之前将保持不变。

实现思路：

遍历 Git 索引中的所有文件。
这些文件本身就是已添加到暂存区的文件，因为 Git 索引就是暂存区的表示。
如果你想进一步区分哪些文件是仅添加到暂存区但未被修改，你可以结合上面的“已修改的文件”的检查。




